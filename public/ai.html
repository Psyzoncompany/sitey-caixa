<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PSYZON AI - Estilo Claude</title>
    <link rel="icon" type="image/png" href="img/logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        claude: {
                            bg: '#fdfcf8',
                            sidebar: '#ecece5',
                            border: '#e1e1db',
                            accent: '#da7756',
                            text: '#2d2d2d',
                            userMsg: '#f3f3ee'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        html,
        body {
            width: 100%;
            overflow-x: hidden;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .typing-cursor::after {
            content: '‚ñå';
            animation: blink 1s step-start infinite;
            color: #da7756;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
    </style>
</head>
<body class="bg-claude-bg text-claude-text h-screen overflow-hidden font-sans selection:bg-claude-accent selection:text-white">
    <div class="h-screen w-full flex flex-col overflow-hidden">
        <header class="h-14 shrink-0 bg-slate-950 text-white border-b border-slate-800 px-4 md:px-6 flex items-center justify-between z-30">
            <a href="index.html" class="flex items-center gap-2">
                <img src="img/logo.png" alt="PSYZON" class="h-8 w-8 object-contain">
                <span class="text-sm md:text-base font-semibold tracking-wide">PSYZON Caixa</span>
            </a>

            <nav class="hidden md:flex items-center gap-2 text-sm">
                <a href="index.html" class="px-3 py-1.5 rounded-lg hover:bg-white/10">Dashboard</a>
                <a href="processos.html" class="px-3 py-1.5 rounded-lg hover:bg-white/10">Processos</a>
                <a href="ai.html" class="px-3 py-1.5 rounded-lg bg-white/10 text-cyan-300">IA</a>
                <button onclick="window.firebaseAuth?.logout?.()" class="px-3 py-1.5 rounded-lg hover:bg-red-500/20 hover:text-red-300">Sair</button>
            </nav>

            <button id="mobile-menu-btn" class="md:hidden p-2 rounded-lg hover:bg-white/10" aria-label="Abrir menu">
                <i class="fa-solid fa-bars"></i>
            </button>
        </header>

        <div id="mobile-nav" class="hidden bg-slate-950 text-white border-b border-slate-800 px-4 py-3 md:hidden space-y-2">
            <a href="index.html" class="block px-3 py-2 rounded-lg hover:bg-white/10">Dashboard</a>
            <a href="processos.html" class="block px-3 py-2 rounded-lg hover:bg-white/10">Processos</a>
            <a href="ai.html" class="block px-3 py-2 rounded-lg bg-white/10 text-cyan-300">IA</a>
            <button onclick="window.firebaseAuth?.logout?.()" class="w-full text-left px-3 py-2 rounded-lg hover:bg-red-500/20 hover:text-red-300">Sair</button>
        </div>

        <div class="flex-1 flex overflow-hidden min-h-0">
            <aside id="sidebar" class="w-64 bg-claude-sidebar border-r border-claude-border flex flex-col transition-all duration-300 absolute md:relative z-20 h-[calc(100vh-3.5rem)] -translate-x-full md:translate-x-0">
                <div class="p-4">
                    <button onclick="newChat()" class="w-full flex items-center justify-between bg-transparent hover:bg-black/5 border border-claude-border px-3 py-2 rounded-lg transition-colors text-sm font-medium">
                        <span class="flex items-center gap-2"><i class="fa-solid fa-plus text-claude-accent"></i> Novo Chat</span>
                        <i class="fa-solid fa-pen-to-square text-gray-500"></i>
                    </button>
                </div>

                <div class="flex-1 overflow-y-auto no-scrollbar px-3 space-y-1">
                    <div class="text-xs font-semibold text-gray-500 mb-2 px-2 mt-2">Hoje</div>
                    <button class="w-full text-left truncate px-3 py-2 rounded-lg bg-black/5 text-sm font-medium">Ideias para Marketing</button>
                    <button class="w-full text-left truncate px-3 py-2 rounded-lg hover:bg-black/5 text-sm text-gray-700">Revis√£o de C√≥digo JS</button>
                    <div class="text-xs font-semibold text-gray-500 mb-2 px-2 mt-6">Anteriores</div>
                    <button class="w-full text-left truncate px-3 py-2 rounded-lg hover:bg-black/5 text-sm text-gray-700">Resumo do Livro 1984</button>
                    <button class="w-full text-left truncate px-3 py-2 rounded-lg hover:bg-black/5 text-sm text-gray-700">Receita de Bolo de Cenoura</button>
                </div>

                <div class="p-4 border-t border-claude-border">
                    <button class="w-full flex items-center gap-3 hover:bg-black/5 p-2 rounded-lg transition-colors text-sm font-medium">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-claude-accent to-orange-300 text-white flex items-center justify-center font-bold" id="initial-user">U</div>
                        <span id="name-user">Usu√°rio</span>
                        <i class="fa-solid fa-gear ml-auto text-gray-500"></i>
                    </button>
                </div>
            </aside>

            <div id="sidebar-overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/20 z-10 hidden md:hidden"></div>

            <main class="flex-1 flex flex-col h-full relative w-full min-w-0 overflow-hidden">
                <header class="h-14 flex items-center justify-between px-4 border-b border-claude-border/50 bg-claude-bg/80 backdrop-blur-sm z-10 sticky top-0 shrink-0">
                    <div class="flex items-center gap-3">
                        <button onclick="toggleSidebar()" class="md:hidden p-2 text-gray-600 hover:bg-gray-100 rounded-md">
                            <i class="fa-solid fa-bars"></i>
                        </button>
                        <button class="flex items-center gap-2 font-medium text-gray-700 hover:bg-gray-100 px-3 py-1.5 rounded-lg transition-colors text-sm">
                            Meu Modelo 3.5 Pro <i class="fa-solid fa-chevron-down text-xs text-gray-400"></i>
                        </button>
                    </div>
                    <button class="p-2 text-gray-500 hover:bg-gray-100 rounded-lg" title="Compartilhar">
                        <i class="fa-solid fa-arrow-up-from-bracket"></i>
                    </button>
                </header>

                <div id="chat-container" class="flex-1 overflow-y-auto p-4 md:p-6 flex flex-col gap-6 pb-32 min-w-0">
                    <div id="welcome-screen" class="flex flex-col items-center justify-center h-full text-center max-w-2xl mx-auto space-y-6 mt-10">
                        <div class="w-16 h-16 rounded-2xl bg-claude-accent/10 flex items-center justify-center text-claude-accent text-3xl">
                            <i class="fa-solid fa-sparkles"></i>
                        </div>
                        <h1 class="text-3xl font-serif text-gray-800">Ol√°, Rodrigo</h1>
                        <p class="text-gray-500 text-lg">Como posso ajudar voc√™ hoje?</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 w-full mt-8">
                            <button onclick="fillInput('Me ajude a escrever um e-mail profissional')" class="p-4 border border-claude-border rounded-xl text-left hover:bg-gray-50 transition-colors text-sm text-gray-600 flex flex-col gap-2">
                                <span class="font-medium text-gray-800"><i class="fa-regular fa-envelope text-claude-accent"></i> E-mail Profissional</span>
                                Me ajude a escrever um e-mail...
                            </button>
                            <button onclick="fillInput('Quais s√£o as tend√™ncias de tecnologia para 2026?')" class="p-4 border border-claude-border rounded-xl text-left hover:bg-gray-50 transition-colors text-sm text-gray-600 flex flex-col gap-2">
                                <span class="font-medium text-gray-800"><i class="fa-solid fa-microchip text-claude-accent"></i> Tecnologia</span>
                                Tend√™ncias para 2026...
                            </button>
                        </div>
                    </div>
                </div>

                <div class="absolute bottom-0 w-full bg-gradient-to-t from-claude-bg via-claude-bg to-transparent pt-10 pb-6 px-4 md:px-6">
                    <div class="max-w-3xl mx-auto relative">
                        <div class="border border-claude-border bg-white rounded-2xl shadow-sm focus-within:ring-1 focus-within:ring-claude-accent/50 focus-within:border-claude-accent/50 transition-all flex flex-col">
                            <textarea id="user-input" rows="1" placeholder="Mensagem para a IA..." class="w-full max-h-48 resize-none bg-transparent outline-none p-4 text-gray-800 placeholder-gray-400 no-scrollbar" oninput="autoResize(this)" onkeydown="handleEnter(event)"></textarea>
                            <div class="flex items-center justify-between px-3 py-2 text-gray-500">
                                <div class="flex items-center gap-1">
                                    <button class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 hover:text-gray-800 transition" title="Anexar arquivo"><i class="fa-solid fa-paperclip"></i></button>
                                    <button class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 hover:text-gray-800 transition" title="Pesquisar na Web"><i class="fa-solid fa-globe"></i></button>
                                    <button class="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-100 hover:text-gray-800 transition" title="Mensagem de Voz"><i class="fa-solid fa-microphone"></i></button>
                                </div>
                                <button id="send-btn" onclick="sendMessage()" class="w-8 h-8 flex items-center justify-center rounded-lg bg-claude-accent text-white hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" disabled>
                                    <i class="fa-solid fa-arrow-up"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-center text-xs text-gray-400 mt-3">A IA pode cometer erros. Considere verificar informa√ß√µes importantes.</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script type="module" src="firebase-config.js"></script>
    <script>
        const inputEl = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const chatContainer = document.getElementById('chat-container');
        const welcomeScreen = document.getElementById('welcome-screen');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');

        document.getElementById('mobile-menu-btn').addEventListener('click', () => {
            document.getElementById('mobile-nav').classList.toggle('hidden');
        });

        inputEl.addEventListener('input', () => {
            sendBtn.disabled = inputEl.value.trim() === '';
        });

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
            if (textarea.value === '') textarea.style.height = 'auto';
        }

        function handleEnter(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }

        function fillInput(text) {
            inputEl.value = text;
            inputEl.dispatchEvent(new Event('input'));
            inputEl.focus();
        }

        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        function newChat() {
            chatContainer.innerHTML = '';
            chatContainer.appendChild(welcomeScreen);
            welcomeScreen.style.display = 'flex';
            inputEl.value = '';
            inputEl.style.height = 'auto';
            sendBtn.disabled = true;
            if (window.innerWidth < 768) toggleSidebar();
        }

        function sendMessage() {
            const text = inputEl.value.trim();
            if (!text) return;

            if (welcomeScreen.style.display !== 'none') welcomeScreen.style.display = 'none';

            appendMessage(text, 'user');

            inputEl.value = '';
            inputEl.style.height = 'auto';
            sendBtn.disabled = true;

            simulateAIResponse(text);
        }

        function appendMessage(text, sender) {
            const msgDiv = document.createElement('div');
            msgDiv.className = `flex gap-4 max-w-3xl mx-auto w-full group ${sender === 'user' ? 'justify-end' : ''}`;

            if (sender === 'user') {
                msgDiv.innerHTML = `
                    <div class="bg-claude-userMsg px-5 py-3.5 rounded-2xl rounded-tr-sm text-gray-800 whitespace-pre-wrap max-w-[85%] relative">
                        ${escapeHTML(text)}
                        <div class="absolute -left-12 top-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                            <button class="w-8 h-8 rounded hover:bg-gray-100 text-gray-400 hover:text-gray-600 flex items-center justify-center" title="Editar"><i class="fa-solid fa-pen text-xs"></i></button>
                        </div>
                    </div>
                `;
            } else {
                msgDiv.innerHTML = `
                    <div class="w-8 h-8 shrink-0 rounded-lg bg-white border border-gray-200 flex items-center justify-center text-claude-accent mt-1 shadow-sm">
                        <i class="fa-solid fa-sparkles text-sm"></i>
                    </div>
                    <div class="flex-1 text-gray-800 pt-1.5 leading-relaxed relative">
                        <div class="ai-content whitespace-pre-wrap">${text}</div>
                        <div class="opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-2 mt-3 text-gray-400">
                            <button class="hover:text-gray-700 transition" title="Copiar"><i class="fa-regular fa-copy"></i></button>
                            <button class="hover:text-green-600 transition" title="Bom"><i class="fa-regular fa-thumbs-up"></i></button>
                            <button class="hover:text-red-600 transition" title="Ruim"><i class="fa-regular fa-thumbs-down"></i></button>
                            <button class="hover:text-gray-700 transition" title="Regerar"><i class="fa-solid fa-rotate-right"></i></button>
                        </div>
                    </div>
                `;
            }

            chatContainer.appendChild(msgDiv);
            scrollToBottom();
            return msgDiv;
        }

        function simulateAIResponse(userText) {
            const aiMsgNode = appendMessage('<span class="typing-cursor"></span>', 'ai');
            const contentNode = aiMsgNode.querySelector('.ai-content');

            const fullResponse = `Ol√°! Recebi sua mensagem: "${userText}".\n\nA nova interface da IA j√° est√° ativa com layout fixo e pronta para uso em tela completa. Como posso te ajudar agora? üöÄ`;
            let i = 0;
            contentNode.innerHTML = '';

            const interval = setInterval(() => {
                if (i < fullResponse.length) {
                    contentNode.innerHTML = fullResponse.substring(0, i + 1) + '<span class="typing-cursor"></span>';
                    i++;
                    scrollToBottom();
                } else {
                    clearInterval(interval);
                    contentNode.innerHTML = fullResponse;
                }
            }, 15);
        }

        function escapeHTML(str) {
            return str.replace(/[&<>'"]/g, tag => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                "'": '&#39;',
                '"': '&quot;'
            }[tag]));
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        window.addEventListener('load', () => {
            const user = window.firebaseAuth?.getCurrentUser?.();
            const displayName = user?.displayName || user?.email || 'Usu√°rio';
            document.getElementById('name-user').textContent = displayName;
            document.getElementById('initial-user').textContent = (displayName[0] || 'U').toUpperCase();
        });
    </script>
</body>
</html>
